@if (loading() && !reserve()) {
  <mat-card>
    <mat-card-content class="loading-state">
      <mat-icon>hourglass_empty</mat-icon>
      <span>Lade Steuerrücklage…</span>
    </mat-card-content>
  </mat-card>
} @else if (reserve(); as r) {
  <mat-card [class.on-track]="onTrack()" [class.behind]="!onTrack()">
    <mat-card-header>
      <mat-icon mat-card-avatar class="card-icon" [class.warning-icon]="!onTrack()">
        {{ onTrack() ? 'savings' : 'warning' }}
      </mat-icon>
      <mat-card-title>Steuerrücklage</mat-card-title>
      <mat-card-subtitle>{{ r.year }} &middot; {{ r.monthsRemaining }} Monate verbleibend</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <!-- Progress bar -->
      <div class="progress-section">
        <div class="progress-header">
          <span class="progress-label">Rücklagen-Fortschritt</span>
          <span class="progress-amount">
            {{ r.alreadyReserved | currency:'EUR':'symbol':'1.2-2':'de-DE' }}
            / {{ r.annualReserve | currency:'EUR':'symbol':'1.2-2':'de-DE' }}
          </span>
        </div>
        <mat-progress-bar
          mode="determinate"
          [value]="progressPercent()"
          [color]="onTrack() ? 'primary' : 'warn'">
        </mat-progress-bar>
      </div>

      <!-- Details -->
      <div class="details">
        <div class="detail-row">
          <span class="detail-label">Netto-Gewinn Selbständigkeit</span>
          <span class="detail-value">{{ r.netSelfEmployedProfit | currency:'EUR':'symbol':'1.2-2':'de-DE' }}</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">Rücklagensatz</span>
          <span class="detail-value">{{ r.reserveRatePercent / 100 | percent:'1.0-0':'de-DE' }}</span>
        </div>
        <div class="detail-row highlight">
          <span class="detail-label">Monatliche Rücklage</span>
          <span class="detail-value monthly">{{ r.monthlyReserve | currency:'EUR':'symbol':'1.2-2':'de-DE' }}</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">Noch zu reservieren</span>
          <span class="detail-value remaining">{{ r.remainingToReserve | currency:'EUR':'symbol':'1.2-2':'de-DE' }}</span>
        </div>
      </div>
    </mat-card-content>
  </mat-card>
}

@if (loading() && !status()) {
  <mat-card>
    <mat-card-content class="loading-state">
      <mat-icon>hourglass_empty</mat-icon>
      <span>Lade Abgabepflicht-Status…</span>
    </mat-card-content>
  </mat-card>
} @else if (status(); as s) {
  <mat-card [class.warning]="s.filingRequired" [class.safe]="!s.filingRequired">
    <mat-card-header>
      <mat-icon mat-card-avatar class="card-icon" [class.warning-icon]="s.filingRequired">
        {{ s.filingRequired ? 'assignment_late' : 'assignment_turned_in' }}
      </mat-icon>
      <mat-card-title>Pflichtveranlagung</mat-card-title>
      <mat-card-subtitle>§46 Abs. 2 EStG — {{ s.year }}</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <div class="amount-display">
        <span class="amount-label">Nebeneinkünfte</span>
        <span class="amount-value" [class.exceeded]="s.filingRequired">
          {{ s.nebeneinkuenfte | currency:'EUR':'symbol':'1.2-2':'de-DE' }}
        </span>
      </div>

      <mat-progress-bar
        mode="determinate"
        [value]="progressValue()"
        [color]="s.filingRequired ? 'warn' : 'primary'">
      </mat-progress-bar>

      <div class="threshold-limits">
        <span>0 €</span>
        <span class="limit-marker">Schwelle: {{ s.threshold | currency:'EUR':'symbol':'1.0-0':'de-DE' }}</span>
      </div>

      <div class="status-row" [class.exceeded]="s.filingRequired">
        <mat-icon>{{ s.filingRequired ? 'cancel' : 'check_circle' }}</mat-icon>
        <span>
          @if (s.filingRequired) {
            Pflichtveranlagung — Steuererklärung erforderlich
          } @else {
            Unter der Grenze — freiwillige Abgabe möglich
          }
        </span>
      </div>
    </mat-card-content>
  </mat-card>
}

@if (loading() && !status()) {
  <mat-card>
    <mat-card-content class="loading-state">
      <mat-icon>hourglass_empty</mat-icon>
      <span>Lade Arbeitszeit-Status…</span>
    </mat-card-content>
  </mat-card>
} @else if (status(); as s) {
  <mat-card [class.warning]="s.exceeded" [class.safe]="!s.exceeded">
    <mat-card-header>
      <mat-icon mat-card-avatar class="card-icon" [class.warning-icon]="s.exceeded">
        {{ s.exceeded ? 'warning' : 'schedule' }}
      </mat-icon>
      <mat-card-title>Arbeitszeitgesetz</mat-card-title>
      <mat-card-subtitle>§3 ArbZG — {{ s.year }}</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <div class="hours-display">
        <span class="hours-value" [class.exceeded]="s.exceeded">
          {{ s.avgTotalHoursWeekly | number:'1.1-1':'de-DE' }}h
        </span>
        <span class="hours-limit">/ {{ s.maxAllowedHoursWeekly | number:'1.0-0':'de-DE' }}h pro Woche</span>
      </div>

      <mat-progress-bar
        mode="determinate"
        [value]="progressValue()"
        [color]="s.exceeded ? 'warn' : 'primary'">
      </mat-progress-bar>

      <!-- Hours breakdown -->
      <div class="hours-breakdown">
        <div class="bar-row">
          <span class="bar-label">Angestellt</span>
          <div class="bar-track">
            <div class="bar-fill employment"
                 [style.width.%]="employmentBarWidth()"></div>
          </div>
          <span class="bar-value">{{ s.avgEmploymentHoursWeekly | number:'1.1-1':'de-DE' }}h</span>
        </div>
        <div class="bar-row">
          <span class="bar-label">Selbständig</span>
          <div class="bar-track">
            <div class="bar-fill self-employed"
                 [class.risk]="s.exceeded"
                 [style.width.%]="selfEmployedBarWidth()"></div>
          </div>
          <span class="bar-value">{{ s.avgSelfEmployedHoursWeekly | number:'1.1-1':'de-DE' }}h</span>
        </div>
      </div>

      <div class="status-row" [class.exceeded]="s.exceeded">
        <mat-icon>{{ s.exceeded ? 'cancel' : 'check_circle' }}</mat-icon>
        <span>
          @if (s.exceeded) {
            Wöchentliche Höchstarbeitszeit überschritten
          } @else {
            Innerhalb der zulässigen Arbeitszeit
          }
        </span>
      </div>
    </mat-card-content>
  </mat-card>
}
